#!/bin/sh -e

case "$1" in
    alternatives|build|checksum|download|install|list|remove|search|update|version|''|\
    help-ext|chroot|depends|export|fork|help|link|maintainer|manifest|new|orphans|outdated|\
    owns|reset|revdepends|size)
        /usr/bin/kiss "$@"
    ;;
    add)
        shift 1
        [ "$#" -ne 0 ] && {
            for _pkg in "$@"; do
                [ $(cat $HOME/usr/src/eudald-kiss/metapkg/depends | grep -w "$_pkg") ] && {
                    [ ! $(kiss l "$_pkg") ] && added=true
                } || {
                    echo "$_pkg" >> $HOME/usr/src/eudald-kiss/metapkg/depends
                    added=true
                }
            done
            [ "$added" ] && kiss bi metapkg
        }
    ;;
    del)
        shift 1
        [ "$#" -ne 0 ] && {
            for _pkg in "$@"; do
                [ $(cat $HOME/usr/src/eudald-kiss/metapkg/depends | grep -w "$_pkg") ] && {
                    sed -i "/$_pkg/d" $HOME/usr/src/eudald-kiss/metapkg/depends
                    deleted=true
                } || {
                    [ $(kiss l "$_pkg") ] && deleted=true
                }
            done
            [ "$deleted" ] && kiss bi metapkg && kiss ro
        }
    ;;
    live)
        kiss bi grub libisoburn squashfs-tools syslinux
    ;;
    ro)
        while kiss o | grep -qv "${2:-metapkg}"; do
            kiss r `kiss o | grep -v "${2:-metapkg}" | tr '\n' ' '`
        done
    ;;
    *)
        _1="$1"
        shift 1
        for _action in $(echo "$_1" | grep -o .); do
            [ "$_action" = u ] && {
                /usr/bin/kiss "$_action"
            } || {
                /usr/bin/kiss "$_action" "$@"
            }
        done
    ;;
esac
